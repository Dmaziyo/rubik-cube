**èƒŒæ™¯**ï¼šæƒ³å­¦ä¹ ä¸€ä¸‹three.jsï¼Œå¹¶ä¸”åšä¸ªé­”æ–¹ï¼ŒåŒæ—¶æŠŠä¸‰é˜¶é­”æ–¹å­¦ä¼šã€‚ 

**å‚è€ƒ**:
- https://github.com/pengfeiw/rubiks-cube
- https://zhuanlan.zhihu.com/p/33580374

- [Todos](#todos)
- [é—®é¢˜](#é—®é¢˜)
    - [ä½¿ç”¨live with serveræ— æ³•è®¿é—®jsæˆ–è€…å…¶ä»–assetæ–‡ä»¶](#ä½¿ç”¨live-with-serveræ— æ³•è®¿é—®jsæˆ–è€…å…¶ä»–assetæ–‡ä»¶)
    - [åˆå§‹ç¯å¢ƒé…ç½®](#åˆå§‹ç¯å¢ƒé…ç½®)
    - [æ„å»ºæ–¹å—](#æ„å»ºæ–¹å—)
    - [æ„å»ºå¹³é¢](#æ„å»ºå¹³é¢)
    - [ä¸ºäº†èƒ½å¤Ÿå°†å¹³é¢ç»„æˆä¸€ä¸ªæ­£æ–¹ä½“ï¼Œéœ€è¦æ ¹æ®å¹³é¢çš„é•¿åº¦è¿›è¡Œç§»åŠ¨ï¼Œå¦‚ä½•è®¡ç®—å¹³é¢å‘¢ï¼Ÿ](#ä¸ºäº†èƒ½å¤Ÿå°†å¹³é¢ç»„æˆä¸€ä¸ªæ­£æ–¹ä½“éœ€è¦æ ¹æ®å¹³é¢çš„é•¿åº¦è¿›è¡Œç§»åŠ¨å¦‚ä½•è®¡ç®—å¹³é¢å‘¢)
    - [æ„å»ºæ­£æ–¹ä½“](#æ„å»ºæ­£æ–¹ä½“)
    - [å¼•ç”¨æ’ä»¶å‡ºç°è·¯å¾„é”™è¯¯](#å¼•ç”¨æ’ä»¶å‡ºç°è·¯å¾„é”™è¯¯)
    - [å®ç°né˜¶é­”æ–¹è‡ªåŠ¨ç”Ÿæˆï¼Œå› ä¸ºä¹‹å‰å†™çš„æ˜¯æ­»çš„ï¼Œåªèƒ½ç”Ÿæˆä¸‰é˜¶é­”æ–¹](#å®ç°né˜¶é­”æ–¹è‡ªåŠ¨ç”Ÿæˆå› ä¸ºä¹‹å‰å†™çš„æ˜¯æ­»çš„åªèƒ½ç”Ÿæˆä¸‰é˜¶é­”æ–¹)
    - [é­”æ³•è§†è§’ç§»åŠ¨](#é­”æ³•è§†è§’ç§»åŠ¨)
    - [å®ç°é¼ æ ‡é€‰ä¸­æ–¹å—](#å®ç°é¼ æ ‡é€‰ä¸­æ–¹å—)
    - [å¦‚ä½•é€šè¿‡meshçš„ä¸–ç•Œåæ ‡ä½ç½®è·å–åˆ°æµè§ˆå™¨äºŒç»´å±å¹•åæ ‡ä½ç½®?](#å¦‚ä½•é€šè¿‡meshçš„ä¸–ç•Œåæ ‡ä½ç½®è·å–åˆ°æµè§ˆå™¨äºŒç»´å±å¹•åæ ‡ä½ç½®)
    - [ç¡®å®šéœ€è¦æ—‹è½¬çš„å¹³é¢](#ç¡®å®šéœ€è¦æ—‹è½¬çš„å¹³é¢)
    - [æ—‹è½¬æ–¹å—](#æ—‹è½¬æ–¹å—)
    - [æ›´æ–°æ–¹å—çŠ¶æ€](#æ›´æ–°æ–¹å—çŠ¶æ€)
    - [æ‰“åŒ…éƒ¨ç½²](#æ‰“åŒ…éƒ¨ç½²)
    - [å¦‚ä½•å®ç°shuffleæ—‹è½¬åŠ¨ç”»](#å¦‚ä½•å®ç°shuffleæ—‹è½¬åŠ¨ç”»)
    - [å¦‚ä½•æŠŠæ–¹å—ç©ºéš™å‘¨å›´å˜é»‘ï¼Œå½“å‰é­”æ–¹åªæœ‰åœ¨sceneèƒŒæ™¯è®¾ç½®ä¸ºé»‘è‰²çš„æ—¶å€™æ‰æ˜¯æ­£å¸¸é¢œè‰²ï¼Œå…¶ä½™æƒ…å†µéƒ½æ¯”è¾ƒä¸‘](#å¦‚ä½•æŠŠæ–¹å—ç©ºéš™å‘¨å›´å˜é»‘å½“å‰é­”æ–¹åªæœ‰åœ¨sceneèƒŒæ™¯è®¾ç½®ä¸ºé»‘è‰²çš„æ—¶å€™æ‰æ˜¯æ­£å¸¸é¢œè‰²å…¶ä½™æƒ…å†µéƒ½æ¯”è¾ƒä¸‘)
    - [é­”æ–¹è¿˜åŸ](#é­”æ–¹è¿˜åŸ)


## Todos
- [x] æ­å»ºåˆå§‹åŒ–ç¯å¢ƒ
    - [x] tsç¯å¢ƒ
    - [x] web-dev-serverä½œè¿è¡Œç¯å¢ƒ
- [x] æ„å»ºrubik-cube
  - [x] æ„å»ºæ–¹å—
  - [x] æ„å»ºå¹³é¢
  - [x] æ„å»ºé­”æ–¹
  - [x] ç¼©æ”¾é€‚é…
  - [x] né˜¶é­”æ–¹è‡ªåŠ¨ç”Ÿæˆ
  - [x] é­”æ–¹è§†è§’ç§»åŠ¨
- [x] å®ç°æ“ä½œåŠŸèƒ½
  - [x] é¼ æ ‡é€‰ä¸­æ–¹å—
  - [x] æ‰¾å‡ºè¦æ—‹è½¬çš„æ–¹å‘
  - [x] ç¡®è®¤éœ€è¦æ—‹è½¬çš„æ–¹å—
  - [x] æ—‹è½¬é¢
    - [x] æ—‹è½¬æ–¹å—
    - [x] æ›´æ–°æ–¹å—ä½ç½®
- [x] æ‰“ä¹±æ“ä½œ
- [ ] è¿˜åŸæ“ä½œ
- [ ] æ›´æ”¹é˜¶æ•°

## é—®é¢˜

#### ä½¿ç”¨live with serveræ— æ³•è®¿é—®jsæˆ–è€…å…¶ä»–assetæ–‡ä»¶
```
åŸå› ï¼šlive with serveræ’ä»¶åªèƒ½åŒ…å«å½“å‰è¿è¡Œç›®å½•å’Œå­ç›®å½•çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç›®å½•å¤–çš„ï¼Œé€šè¿‡ç›¸é‚»æ–¹å¼æ˜¯æ— æ³•è®¿é—®çš„ã€‚
å‚è€ƒ:https://stackoverflow.com/questions/56808188/live-server-not-loading-css
```

#### åˆå§‹ç¯å¢ƒé…ç½®
```js
{
  "name": "rubik-cube-maziyo",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "tsc:watch": "tsc --watch",
    "start": "concurrently --kill-others --names tsc,web-dev-server \"npm run tsc:watch\" \"web-dev-server --config web-dev-server.config.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@types/three": "^0.163.0",
    "@web/dev-server": "^0.4.3",
    "concurrently": "^8.2.2",
    "rimraf": "^5.0.5",
    "typescript": "^5.4.3"
  },
  "dependencies": {
    "three": "^0.163.0"
  }
}

```

#### æ„å»ºæ–¹å—
```js
// åˆ©ç”¨three.jsæä¾›çš„shapeï¼Œåœ¨äºŒç»´å¹³é¢ä¸Šæ„å»ºä¸œè¥¿,ç”»å¥½çº¿åå¯ä»¥ä½¿ç”¨geometryæ„å»ºå½¢çŠ¶
export const createSquare = (color: Color) => {
  const squareShape = new Shape()
  const x = 0,
    y = 0
  // top
  squareShape.moveTo(x - 0.4, y + 0.5)
  squareShape.lineTo(x + 0.4, y + 0.5)
  // ä¸ºäº†ä½¿å¾—æ–¹å—è¾¹ç¼˜æ›´å¹³æ»‘,è´å¡æ–¯æ›²çº¿ï¼Œå¤´æ¬¡çœŸæ­£äº†è§£å•Š
  squareShape.bezierCurveTo(x + 0.5, y + 0.5, x + 0.5, y + 0.5, x + 0.5, y + 0.4)

  // right
  squareShape.lineTo(x + 0.5, y - 0.4)
  squareShape.bezierCurveTo(x + 0.5, y - 0.5, x + 0.5, y - 0.5, x + 0.4, y - 0.5)

  // bottom
  squareShape.lineTo(x - 0.4, y - 0.5)
  squareShape.bezierCurveTo(x - 0.5, y - 0.5, x - 0.5, y - 0.5, x - 0.5, y - 0.4)

  // left
  squareShape.lineTo(x - 0.5, y + 0.4)
  squareShape.bezierCurveTo(x - 0.5, y + 0.5, x - 0.5, y + 0.5, x - 0.4, y + 0.5)

  const geometry = new ShapeGeometry(squareShape)
  const material = new MeshBasicMaterial({ color })
  const mesh = new SquareMesh(geometry, material)
  return mesh
}
```
#### æ„å»ºå¹³é¢
```js
// æ ¹æ®å°æ–¹å—çš„ä½ç½®ç”Ÿæˆå¹³é¢
const createPlane = (color: ColorRepresentation, squarePos: Vector2[]) => {
  const square = createSquare(new Color(color))

  const plane: Group = new Group()
  for (let i = 0; i < squarePos.length; i++) {
    const squareClone = square.clone()
    squareClone.translateX(squarePos[i].x)
    squareClone.translateY(squarePos[i].y)
    plane.add(squareClone)
  }
  return plane
}
```
#### ä¸ºäº†èƒ½å¤Ÿå°†å¹³é¢ç»„æˆä¸€ä¸ªæ­£æ–¹ä½“ï¼Œéœ€è¦æ ¹æ®å¹³é¢çš„é•¿åº¦è¿›è¡Œç§»åŠ¨ï¼Œå¦‚ä½•è®¡ç®—å¹³é¢å‘¢ï¼Ÿ
```js
// ä½¿ç”¨box3æ¥æ„å»ºä¸€ä¸ªæœ€å°ç¨‹åº¦è£…ä¸‹å¹³é¢çš„ç›’å­
// å‚è€ƒï¼šhttps://stackoverflow.com/questions/59493236/how-can-i-get-the-dimensions-of-a-three-js-group
  const size = new Vector3()
  let box = new Box3().setFromObject(plane)
  box.getSize(size)
  console.log(size)
```
#### æ„å»ºæ­£æ–¹ä½“
```js
  const transforms = [
    {
      rotateX: Math.PI * 0.5, // ä¸Š
      rotateY: 0
    },
    {
      rotateX: -Math.PI * 0.5, // ä¸‹
      rotateY: 0
    },
    {
      rotateX: 0,
      rotateY: Math.PI * 0.5 // å·¦
    },
    {
      rotateX: 0,
      rotateY: -Math.PI * 0.5 //å³
    },
    {
      rotateX: 0, //å‰
      rotateY: 0
    },
    {
      rotateX: -Math.PI, //å‰
      rotateY: 0
    }
  ]
  //é€šè¿‡æ—‹è½¬å¹³é¢ï¼Œç„¶åè¿›è¡Œå‰åå¹³ç§»
  for (let i = 0; i < planes.length; i++) {
    if (!!transforms[i].rotateX) {
      planes[i].rotateX(transforms[i].rotateX)
    } else {
      planes[i].rotateY(transforms[i].rotateY)
    }
    //å› ä¸ºtranslateæ˜¯ç›¸å¯¹äºlocal spaceè¿›è¡Œç§»åŠ¨ï¼Œæ— éœ€è°ƒæ•´
    planes[i].translateZ(length / 2)
  }
  return planes.reduce((acc, cur) => acc.add(cur), new Group())
```
#### å¼•ç”¨æ’ä»¶å‡ºç°è·¯å¾„é”™è¯¯
```js
å‚è€ƒï¼šhttps://discourse.threejs.org/t/error-relative-references-must-start-with-either-or/13573/18
ä»–æ˜¯çœ‹äº†å®˜ç½‘åˆ«äººçš„examplesæ˜¯å¦‚ä½•ä½¿ç”¨cdnæ¥å¼•ç”¨æ’ä»¶çš„æ–¹æ³•
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/"
        }
      }
    </script>
é€šè¿‡å†™æ˜ å°„çš„æ–¹æ³•æ¥å®ç°å¼•å…¥
import { OrbitControls } from 'three/addons/controls/OrbitControls.js'
export function log() {
  console.log(OrbitControls)
}

```

#### å®ç°né˜¶é­”æ–¹è‡ªåŠ¨ç”Ÿæˆï¼Œå› ä¸ºä¹‹å‰å†™çš„æ˜¯æ­»çš„ï¼Œåªèƒ½ç”Ÿæˆä¸‰é˜¶é­”æ–¹
```js
// æ ¹æ®ä¼ å…¥é˜¶æ•°æ¥ç¡®å®šä¸€ä¸ªé¢çš„æ–¹å—æ•°
  private initElements() {

    // ç”±å·¦ä¸Šè§’æ–¹å—çš„ä¸­å¿ƒç‚¹å¼€å§‹ï¼Œæ ¹æ®é˜¶æ•°æ¥éå†ç”Ÿæˆï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/33580374
    const leftUp = -(this.cubeOrder * this._size) / 2+this._size/2 
    for (let i = 0; i < this.cubeOrder; i++) {
      for (let j = 0; j < this.cubeOrder; j++) {
        this.elements.push({
          color: this.colors[0],
          pos: new Vector3(leftUp + i * this._size, leftUp + j * this._size, (this.cubeOrder * this._size) / 2),
          direction: new Vector3(0, 0, 1) //å‰
        })
        this.elements.push({
          color: this.colors[1],
          pos: new Vector3(leftUp + i * this._size, leftUp + j * this._size, -(this.cubeOrder * this._size) / 2),
          direction: new Vector3(0, 0, -1) //å
        })

        this.elements.push({
          color: this.colors[2],
          pos: new Vector3(-(this.cubeOrder * this._size) / 2, leftUp + i * this._size, leftUp + j * this._size),
          direction: new Vector3(-1, 0, 0) //å·¦
        })

        this.elements.push({
          color: this.colors[3],
          pos: new Vector3((this.cubeOrder * this._size) / 2,leftUp + i * this._size, leftUp + j * this._size),
          direction: new Vector3(1, 0, 0) //å³
        })

        this.elements.push({
          color: this.colors[4],
          pos: new Vector3(leftUp + i * this._size,(this.cubeOrder * this._size) / 2, leftUp + j * this._size),
          direction: new Vector3(0, 1, 0) //ä¸Š
        })
        this.elements.push({
          color: this.colors[5],
          pos: new Vector3(leftUp + i * this._size,-(this.cubeOrder * this._size) / 2, leftUp + j * this._size),
          direction: new Vector3(0, -1, 0) //ä¸‹
        })
      }
    }
  }
```
#### é­”æ³•è§†è§’ç§»åŠ¨
```js
/* ä¸€å¼€å§‹æƒ³ä½¿ç”¨orbitControlæ¥ç€ï¼Œä½†æ˜¯orbitControlæ— æ³•360Â°æ—‹è½¬ï¼Œç„¶åçœ‹äº†ä¸‹å‚è€ƒé¡¹ç›®çš„æºç ï¼Œå‘ç°æ˜¯è‡ªå·±å†™äº†ä¸€ä¸ªè§†è§’æ§åˆ¶å™¨
   ç„¶ååœ¨ç½‘ä¸Šæœäº†ä¸‹ï¼Œå‘ç°è¿˜æœ‰ä¸ªæä¾›çš„controls trackballControlsèƒ½å¤Ÿ360Â°æ—‹è½¬ï¼Œä½†æ˜¯ä¸ä¼šå†™å¤šä¸ªæ§åˆ¶å™¨çš„æ“ä½œé€»è¾‘ï¼Œä¸çŸ¥é“æ€ä¹ˆè§£å†³åç»­æ–¹å—ç§»åŠ¨ï¼Œæ‰€ä»¥è¿˜æ˜¯å‚è€ƒæºç çš„å†™å§
*/ 
  private mouseMoveHandler(e:MouseEvent) {
    if(this.mouseDown){
      // è®¡ç®—ç§»åŠ¨å‘é‡ä½ç½®
      const moveVector = new Vector2(e.movementX, -e.movementY);

      //å› ä¸ºé¼ æ ‡ç§»åŠ¨çš„æ—¶å€™ç‰©ä½“æ˜¯ä»¥å‚ç›´äºç§»åŠ¨å‘é‡çš„æ³•å‘é‡ä½œä¸ºè½´è½¬åŠ¨çš„
      const rotateDir = moveVector.rotateAround(new Vector2(0, 0), Math.PI / 2).normalize();

      rotateAroundWorldAxis(this.cube,new Vector3(rotateDir.x,rotateDir.y),this.rotateSpeed)
      this.renderer.render(this.scene,this.camera)
    }
  }
export function rotateAroundWorldAxis(object: Object3D, axis: Vector3, radians: number) {
  const mat = new Matrix4()
  // è®©çŸ©é˜µç»•axisä¸ºè½´æ—‹è½¬radianså˜æˆtransform matrix
  mat.makeRotationAxis(axis, radians)
  //   æ³¨æ„ä¸èƒ½äº¤æ¢
  object.matrix.premultiply(mat)

  //   è®©ç‰©ä½“æ—‹è½¬
  object.rotation.setFromRotationMatrix(object.matrix)
}
```

#### å®ç°é¼ æ ‡é€‰ä¸­æ–¹å—
```js
// ä½¿ç”¨raycaster
  private mouseDownHandler(e: MouseEvent) {
    this.mouseDown = true

    // å°†å…¶è½¬æ¢ä¸ºNDCåæ ‡,å› ä¸ºå½“å‰åæ ‡æ˜¯ä»¥å·¦ä¸Šè§’ä¸º(0,0)å¼€å¤´çš„,è¦è½¬æ¢ä¸ºä¸­å¿ƒä¸º(0,0)å¹¶ä¸”å·¦å³èŒƒå›´ä¸º[-1,1]çš„åæ ‡
    const x = (e.clientX / window.innerWidth) * 2 - 1
    const y = -(e.clientY / window.innerHeight) * 2 + 1
    this.raycaster.setFromCamera(new Vector2(x, y), this.camera)

    // calculate objects intersecting the picking ray
    const intersects = this.raycaster.intersectObjects(this.scene.children)

    if (intersects.length > 0) {
      // Intersections are returned sorted by distance, closest first.
      ;(intersects[0].object as SquareMesh).material.color.set(Math.random() * 0xff0000)
      this.renderer.render(this.scene, this.camera)
    }
  }
```

#### å¦‚ä½•é€šè¿‡meshçš„ä¸–ç•Œåæ ‡ä½ç½®è·å–åˆ°æµè§ˆå™¨äºŒç»´å±å¹•åæ ‡ä½ç½®?
```js
//é€šè¿‡meshçš„ä¸–ç•Œåæ ‡ä½ç½®è¿›è¡ŒcameraæŠ•å°„ï¼Œç„¶åå°†æ ‡å‡†åæ ‡è½¬æ¢æˆå±å¹•åæ ‡å³å¯
// å‚è€ƒï¼šhttps://discourse.threejs.org/t/how-to-converting-world-coordinates-to-2d-mouse-coordinates-in-threejs/2251/2
  function getSquareScreenPos(square: SquareMesh, camera: Camera, winSize: { w: number; h: number }) {
    if (!this.squares.includes(square)) {
      return null
    }

    const { w, h } = winSize
    let vect3 = new Vector3()
    square.getWorldPosition(vect3)
    vect3.project(camera)
    vect3.x = ((vect3.x + 1) * winSize.w) / 2
    vect3.y = (-(vect3.y - 1) * winSize.h) / 2
    vect3.z = 0

    return {
      x: vect3.x,
      y: vect3.y
    }
  }
```
#### ç¡®å®šéœ€è¦æ—‹è½¬çš„å¹³é¢
```js

      let miniAngle = scrollDir.angleTo(rotateDirections[0].scrollDir)
      let rotateDir = rotateDirections[0]
      for (let i = 1; i < rotateDirections.length; i++) {
        let curAngle = scrollDir.angleTo(rotateDirections[i].scrollDir)
        if (miniAngle > curAngle) {
          miniAngle = curAngle
          rotateDir = rotateDirections[i]
        }
      }
      // æ—‹è½¬è½´ï¼šé€šè¿‡å‰ç§¯è®¡ç®—åŒæ—¶å‚ç›´äºæ³•å‘é‡å’Œæ—‹è½¬å‘é‡çš„å‘é‡
      const rotateDirLocal = rotateDir.endSquare.position.clone().sub(rotateDir.startSquare.position).normalize() //åœ¨local spaceä¸­æ—‹è½¬çš„æ–¹å‘
      const rotateAxis = squareNormal.cross(rotateDirLocal)


      // å› ä¸ºç”Ÿæˆçš„æ–¹å—æ˜¯å¹³é¢,ä¸æ˜¯ç«‹ä½“çš„ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡innerPosæ¥ç¡®è®¤ä¸­å¿ƒ
      // æ—‹è½¬æ–¹å—ï¼šé€šè¿‡æ‰¾controlSquareçš„innerPosåˆ°å…¶ä»–æ–¹å—çš„innerPosç»„æˆçš„å‘é‡ä¸æ—‹è½¬è½´æ˜¯å‚ç›´çš„
      const controlInnerPos = getInnerPos(controlSquare, this.cubeData._size)
      const rotateSquares = this.squares.filter(square => {
        const tempInner = getInnerPos(square, this.cubeData._size)
        const vect = tempInner.clone().sub(controlInnerPos)
        return vect.dot(rotateAxis) === 0
      })
```
#### æ—‹è½¬æ–¹å—
```js
    const rotateAxisLocal = this.state.rotateAxisLocal!
    const rotateSquares = this.state.rotateSquares
    const rotateDir = this.state.rotateDir!

    // æ—‹è½¬çš„è§’åº¦=æŠ•å½±çš„é•¿åº¦/é­”æ–¹å®½åº¦*90Â°ï¼Œæ—‹è½¬å¼§åº¦å¯ä»¥è‡ªå®šä¹‰
    // æŠ•å½±ï¼šå±å¹•æ»‘åŠ¨æ–¹å‘åœ¨æ—‹è½¬æ–¹å‘ä¸Šçš„æŠ•å½±,è¿™ä¹Ÿå°±æ˜¯è®¡ç®—å±å¹•è·ç¦»çš„å¦å¤–ä¸€ä¸ªç”¨å¤„
    const projLen = Math.cos(scrollDir.angleTo(rotateDir.scrollDir)) * scrollDir.length()
    const cubeSize = this.getCubeScreenSize(camera, winSize)
    // å› ä¸ºscrollDirä¸€ç›´æ˜¯ä»downåˆ°moveè®¡ç®—çš„ï¼Œæ˜¯ç´¯åŠ çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè®¡ç®—å¾—å‡ºçš„æ˜¯æ€»å…±æ—‹è½¬è§’åº¦
    const angleRotated = ((projLen / cubeSize) * Math.PI) / 2
    // éœ€è¦æ—‹è½¬çš„è§’åº¦

    const rotateAngle = angleRotated - this.state.angleRotated
    this.state.angleRotated = angleRotated
    console.log(rotateAngle)

    // ä½¿ç”¨transform çŸ©é˜µæ¥æ—‹è½¬æ–¹å—
    const rotateMat = new Matrix4().makeRotationAxis(rotateAxisLocal, rotateAngle)

    rotateSquares.forEach(square => {
      square.applyMatrix4(rotateMat)
      square.updateMatrix()
    })
```

#### æ›´æ–°æ–¹å—çŠ¶æ€
```js
  public afterRotate() {
    let angleRotated = this.state.angleRotated
    // å°†å·²ç»æ—‹è½¬çš„è§’åº¦%90Â°è®¡ç®—è¶…å‡ºçš„åº¦æ•°
    const rotateSquares = this.state.rotateSquares

    const exceedAnglePI = Math.abs(angleRotated) % (Math.PI * 0.5)

    let needRotateAngle = exceedAnglePI > Math.PI * 0.25 ? Math.PI * 0.5 - exceedAnglePI : -exceedAnglePI
    needRotateAngle = angleRotated > 0 ? needRotateAngle : -needRotateAngle
    // è°ƒæ•´ä½ç½®
    const rotateMat = new Matrix4().makeRotationAxis(this.state.rotateAxisLocal!, needRotateAngle)
    rotateSquares.forEach(square => {
      square.applyMatrix4(rotateMat)
      square.updateMatrix()
    })

    angleRotated += needRotateAngle

    // æ¯æ¬¡æ—‹è½¬å®Œéƒ½è¦æ›´æ–°ï¼Œå› ä¸ºæ¯æ¬¡æ—‹è½¬å®Œåéƒ½ä¼šäº§ç”Ÿå°æ•°ç‚¹çš„åå·®
    rotateSquares.forEach(square => {
      const normal = square.element.normal.clone()
      const pos = square.element.pos.clone()
      square.element.normal = vector3Calibration(
        normal.applyMatrix4(new Matrix4().makeRotationAxis(this.state.rotateAxisLocal!, angleRotated))
      )
      // ä»¥posä¸ºåŸºå‡†æ˜¯å› ä¸ºposæ²¡æœ‰åœ¨æ—‹è½¬çš„æ—¶å€™å‘ç”Ÿå˜æ›´ï¼Œè€Œpositionåœ¨æ—‹è½¬çš„æ—¶å€™æ•°å­—å˜æˆäº†æµ®ç‚¹æ•°ï¼Œåå·®è¾ƒå¤§
      square.element.pos = vector3Calibration(pos.applyMatrix4(new Matrix4().makeRotationAxis(this.state.rotateAxisLocal!, angleRotated)))
      //å¾®è°ƒä½ç½®ï¼Œå› ä¸ºæ—‹è½¬çš„æ—¶å€™radianä¸æ˜¯æ•´æ•°ï¼Œæ‰€ä»¥ä¼šå½¢å˜
      square.position.copy(square.element.pos)
      square.updateMatrix()
    })

    this.state.resetSate()
  }
```

#### æ‰“åŒ…éƒ¨ç½²
```js
æ‰“åŒ…å‚è€ƒæ–‡æ¡£ï¼šhttps://open-wc.org/docs/building/rollup/
ç…§ç€æ–‡æ¡£å¤åˆ¶ç²˜è´´ç„¶åé…ç½®å…¥å£æ–‡ä»¶å³å¯
éƒ¨ç½²å‚è€ƒï¼šhttps://github.com/JamesIves/github-pages-deploy-action
  "scripts": {
    "tsc:watch": "tsc --watch",
    "start": "concurrently --kill-others --names tsc,web-dev-server \"npm run tsc:watch\" \"web-dev-server --config web-dev-server.config.js",
    "build": "rimraf dist && tsc && rollup -c rollup.config.js"
  },

  //workflow
  name: Build and Deploy
on:
  push:
    branches:
      - main
permissions:
  contents: write
jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }} # Recommended if you intend to make multiple deployments in quick succession.
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Install and Build ğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: |
          npm i
          npm run build

      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist

```
#### å¦‚ä½•å®ç°shuffleæ—‹è½¬åŠ¨ç”»
```js
// å‚è€ƒï¼šhttps://github.com/Aaron-Bird/rubiks-cube
//éšæœºé€‰å–ä¸€ä¸ªæ–¹å—ï¼Œç„¶åè®¡ç®—å¯èƒ½çš„æ–¹å‘ï¼Œç„¶åéšæœºé€‰å–ï¼Œæœ€åå†ä»-180-180æ—‹è½¬
    const controlSquare = this.squares[Math.floor(Math.random() * this.squares.length)]
    rotateDir = rotateDirections[Math.floor(Math.random() * rotateDirections.length)]
    const rotateAngle = Math.random() > 0.5 ? Math.PI * (Math.random() * 0.5 + 0.5) : -Math.PI * (Math.random() * 0.5 + 0.5)
// æ—‹è½¬åŠ¨ç”»ï¼Œä½¿ç”¨tween.jsæä¾›çš„æ–¹æ³•æ¥å®ç°è¡¥é—´æ•ˆæœ
  private rotateAnimation(rotateSquares: SquareMesh[], rotateAxisLocal: Vector3, rotateAngle: number) {
    const current = { rad: 0 }
    const end = { rad: rotateAngle }
    const time = Math.abs(rotateAngle) * (500 / Math.PI)
    const previous = { rad: current.rad }
    return new Promise((resolve, reject) => {
      try {
        new TWEEN.Tween(current)
          .to(end, time)
          .easing(TWEEN.Easing.Quadratic.Out)
          .onUpdate(() => {
            // ä½¿ç”¨transform çŸ©é˜µæ¥æ—‹è½¬æ–¹å—
            const rotateMat = new Matrix4().makeRotationAxis(rotateAxisLocal, current.rad - previous.rad)
            previous.rad = current.rad
            // ç›¸å¯¹äºlocal spaceçš„æ—‹è½¬è½´è¿›è¡Œæ—‹è½¬
            rotateSquares.forEach(square => {
              square.applyMatrix4(rotateMat)
              square.updateMatrix()
            })
          })
          .onComplete(cur => {
            // æ›´æ–°æ—‹è½¬è§’åº¦
            this.state.angleRotated = rotateAngle
            // é‡ç½®çŠ¶æ€
            this.afterRotate()
            resolve(cur)
          })
          .start(undefined)
      } catch (err) {
        reject(err)
      }
    })
  }
```
#### å¦‚ä½•æŠŠæ–¹å—ç©ºéš™å‘¨å›´å˜é»‘ï¼Œå½“å‰é­”æ–¹åªæœ‰åœ¨sceneèƒŒæ™¯è®¾ç½®ä¸ºé»‘è‰²çš„æ—¶å€™æ‰æ˜¯æ­£å¸¸é¢œè‰²ï¼Œå…¶ä½™æƒ…å†µéƒ½æ¯”è¾ƒä¸‘
```js
// åœ¨meshçš„local spaceæ·»åŠ ä¸€ä¸ªé»‘è‰²æ–¹å—
  const material2 = new MeshBasicMaterial({
    color: 'black',
    side: DoubleSide
  })

  const plane = new Mesh(geometry, material2)
  // ç§»åŠ¨é åä¸€ç‚¹ï¼Œé˜²æ­¢é‡å 
  plane.position.set(0, 0, -0.1) 
  // ç›–ä½æ•´ä¸ªé­”æ–¹
  plane.scale.copy(new Vector3(1.1, 1.1, 1.1)) 
  mesh.scale.copy(scale)
  mesh.add(plane)
```

#### é­”æ–¹è¿˜åŸ
```js
// å°†æ–¹å—æ•°æ®é‡ç½®ï¼Œç„¶åå†æŠŠsceneæ¸…ç©ºï¼Œé‡æ–°æ·»åŠ 
  public restore() {
    // æ¸…é™¤æ‰€æœ‰å­å…ƒç´ 
    this.clear()

    // é‡æ–°ç”Ÿæˆæ–¹å—
    this.cubeData = new CubeData(this.order)
    this.cubeData.elements.forEach(el => {
      const square = createSquare(el.color, el)
      this.add(square)
    })
  }
```